
<!DOCTYPE html>

<html>
 

    <head>
        <meta charset="UTF-8">
        <title>Document</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    </head>
    <script src="https://cdn.netpie.io/microgear.js"></script>
    
<script type="text/javascript">
  function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&฿]+)=([^&&]*)/gi,function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}
  const APPID = getUrlVars()["APP"].replace("/", "");
  const KEYS  =getUrlVars()["KE"];
  const SECRET  =getUrlVars()["SECR"]; 
  const ALIAS =getUrlVars()["SWIT"];         //  

  var arrayLocalTime = [];
  var microgear = Microgear.create({
    key: KEYS,
    secret: SECRET,
    alias : ALIAS
  });

  microgear.on('message',function(topic,msg) {
    var splitString = msg.split(",");
    arrayLocalTime = splitString;
    console.log(splitString);
    console.log(arrayLocalTime);
    newTable(arrayLocalTime);
    console.log(msg);  // for debug
    if(typeof(split_msg[0])!='undefined' && split_msg[0]==""){
      document.getElementById("Humidity_temp").innerHTML = "Humidity = " + split_msg[1] + " % ,Temp = " + split_msg[2] + " c";
    }
  });

  function deleteTime(index){
    var u=0;
    var nunbertwo=0;
    arrayLocalTime[index] = "99.99";
    arrayLocalTime[index+1] = "99.99";
    console.log(arrayLocalTime);
    newTable(arrayLocalTime);
    var u=u+1;
   //if(u==2){}
   //var   splitlTime=arrayLocalTime;
     microgear.chat("NodeMCU1","Timeall");
  //microgear.chat("NodeMCU1",arrayLocalTime);
   microgear.chat("NodeMCU1",arrayLocalTime[0]+""+arrayLocalTime[1]+""+arrayLocalTime[2]+""+arrayLocalTime[3]+""+arrayLocalTime[4]+""+arrayLocalTime[5]);
  // microgear.chat("NodeMCU1",arrayLocalTime[1]);
   //microgear.chat("NodeMCU1",arrayLocalTime[2]);
   //microgear.chat("NodeMCU1",arrayLocalTime[3]);
  // microgear.chat("NodeMCU1",arrayLocalTime[4]);
  // microgear.chat("NodeMCU1",arrayLocalTime[5]);
  // microgear.chat("NodeMCU1",arrayLocalTime[6]);
  // microgear.chat("NodeMCU1",arrayLocalTime[7]);
  // microgear.chat("NodeMCU1",arrayLocalTime[8]);
 //  microgear.chat("NodeMCU1",arrayLocalTime[9]);
  // microgear.chat("NodeMCU1",arrayLocalTime[10]);
  // microgear.chat("NodeMCU1",arrayLocalTime[11]);
  // microgear.chat("NodeMCU1",arrayLocalTime[12]);
     //microgear.chat("NodeMCU1",arrayLocalTime); 
    
  // for(var i =0;i<=arrayLocalTime.length;i++)
 //  {
   //   microgear.chat("NodeMCU1",arrayLocalTime[i]);
  // }
  // u=0;
   
  //}
  }

  function newTable(tempArray){
    var htmlCode = "";
    for(var i=0;i<tempArray.length;i++){
      if(i%2 === 0 && tempArray[i] !== "" && tempArray[i] !== undefined && tempArray[i] !== "99.99"){
        htmlCode = htmlCode + "<tr><td>"+tempArray[i]+"</td><td>"+tempArray[i+1]+"</td>"+"<td><img border='0' src='https://4svp8a.bn.files.1drv.com/y4mVgFr0lURXzrx5N5zfrxABKNs9Rm7dX-FmyB61pE9dOj9-KWoHU_CBHUOldPwTfICOuZUjGkEI6NTYCmfdwPhUdkjzzpudGq9SkasOLJ338OddTstXbL4QGEMg573BPiXGBeJIyaBntgXRVtlyNVAoN0dEIZYUAFDU76-BimphYfmShsYkuHDzOacZ0o6T8YH62ywhB8rYuN9ssibt4Zdlw?width=256&height=256&cropmode=none' width='48' height='48' onclick='deleteTime("+i+")'></td></tr>";
      }
    }
    document.getElementById("raw_data").innerHTML =  null;
    document.getElementById("raw_data").innerHTML =  htmlCode;
  }

  microgear.on('connected', function() {
    microgear.setAlias(ALIAS);
    //document.getElementById("connected_NETPIE").innerHTML = "Connected to NETPIE"
  });

  microgear.on('present', function(event) {
    console.log(event);
  });

  microgear.on('absent', function(event) {
    console.log(event);
  });

  microgear.resettoken(function(err) {
    microgear.connect(APPID);
  });



  function setdelete(duration="1") {
                // alert(i);
                var nowDate = new Date();
                var newStartTime ="0";
                      
          
               // document.getElementById("bsubmit").click();
                document.getElementById("scrnN").value = "setdelete";
                 document.getElementById("form2").action="YWRjeGYyNDIxZWR3cWFA@as.php";
                 document.getElementById("form2").submit();
           
                
               
                
               // alert(endTime);
                

            }





</script>

<body>
 

<p id="11"></p>
<p id="get_topic"></p>
<strong id="Humidity_temp"></strong>

<div >
  <p><b><h5>แก้ไข้เวลารดน้ำ</h5></b></p>
<table class="w3-table-all">
    <thead>
   <tr class="w3-green">
    <th><h5>เวลาเริ่มรดน้ำ</h5></th>
    <th><h5>เวลาหยุดรดน้ำ</h5></th>
     <th><h5>ลบเวลา</h5></th>
   </tr>   
    </thead>
    <tbody id="raw_data"></tbody>
   
 
</table>
<form action="https://golfais.herokuapp.com/updatetime.html" style="" method="POST">
</form>

</div>
  
<form id="form2" name="form2" method="POST" action="YWRjeGYyNDIxZWR3cWFA@as.php" >
  <input type="hidden" name="etime" id="eTime">
  <input type="hidden" name="stime" id="sTime">
  <input type="hidden" name="scrnN" id="scrnN">

<center>
<br>
<br>
<p><b><h5>ยกเลิกรดน้ำ</h5></b></p>
<td>  
  <img id="PP" border="0" onclick="setdelete()" alt="W3Schools"  src="https://4sxjhq.bn.files.1drv.com/y4mJb6LJqe7wmetywqgGlwWRZgG0DaecBC0V8Md8HYyEVN91r1aKy4Zfb8yp_KZFomXzLhnxBHhEYIsmwyd-OmcqlmzgWd-YTmxLedxAz6u0MgEpRv_KJIML6NuBjbi29viPXAA6WtojTaG3kBaPgbf0kRfSXTnK92lXbhUQKw4w_cDnn3XrvJwyKbfeG2FpbqiG8RQ6XKYn3LAv_xrQNK_tA?width=225&height=225&cropmode=none" width="200" height="200">
  
   
</td>

</center>
</body>

</html>
